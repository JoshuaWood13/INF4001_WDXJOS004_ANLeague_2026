@inject IConfiguration Configuration

<!-- Success Message -->
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show position-fixed"
         style="top: 80px; right: 20px; z-index: 1100; max-width: 400px;" id="successMessage">
        <strong>Success!</strong> @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<!-- Firebase Error Alert -->
<div id="error-message" class="alert alert-danger alert-dismissible fade show position-fixed" 
     style="top: 80px; right: 20px; z-index: 1100; max-width: 400px; display: none;">
    <strong>Error!</strong> <span id="error-text"></span>
    <button type="button" class="btn-close" onclick="hideError(document.getElementById('error-message'))"></button>
</div>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">Login</h3>
                </div>
                <div class="card-body">

                    <form id="login-form">

                        <!-- Email -->
                        <div class="mb-3">
                            <label for="email" class="form-label">Email Address</label>
                            <input type="email" 
                                   id="email" 
                                   name="email"
                                   class="form-control" 
                                   placeholder="email@example.com"
                                   data-val-required="Email address is required" />
                            <span class="invalid-feedback"></span>
                        </div>

                        <!-- Password -->
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" 
                                   id="password" 
                                   name="password"
                                   class="form-control"
                                   data-val-required="Password is required" />
                            <span class="invalid-feedback"></span>
                        </div>
                        
                        <!-- Button -->
                        <button type="submit" id="login-btn" class="btn btn-success w-100 mb-3">
                            <span id="login-text">Login</span>
                            <span id="login-spinner" class="spinner-border spinner-border-sm" style="display: none;"></span>
                        </button>

                        <!-- Redirect -->
                        <div class="text-center">
                            <p class="mb-0">Don't have an account? <a asp-action="SignUp">Sign up here</a></p>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <!-- login script -->
    <script src="~/js/account-login.js"></script>

    <script>
        // Initialize Firebase and login form
        document.addEventListener('DOMContentLoaded', function () {
            const firebaseConfig = {
                apiKey: "@Configuration["FirebaseWeb:ApiKey"]",
                authDomain: "@Configuration["FirebaseWeb:AuthDomain"]",
                projectId: "@Configuration["FirebaseWeb:ProjectId"]",
                storageBucket: "@Configuration["FirebaseWeb:StorageBucket"]",
                messagingSenderId: "@Configuration["FirebaseWeb:MessagingSenderId"]",
                appId: "@Configuration["FirebaseWeb:AppId"]"
            };

            initializeFirebase(firebaseConfig);
            initializeLoginForm('@Url.Action("LoginCallback", "Account")');
        });
    </script>
}
